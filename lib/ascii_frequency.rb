class ASCIIFrequency
  attr_accessor :lookup

  def initialize
    # Statistics from http://fitaly.com/board/domper3/posts/136.html.
    @lookup = {
      0 => 0.000001, 1 => 0.000001, 2 => 0.000001, 3 => 0.000001,
      4 => 0.000001, 5 => 0.000001, 6 => 0.000001, 7 => 0.000001,
      8 => 0.000001, 9 => 0.000057,
      10 => 0.000010, 11 => 0.000001, 12 => 0.000001, 13 => 0.000001,
      14 => 0.000001, 15 => 0.000001, 16 => 0.000001, 17 => 0.000001,
      18 => 0.000001, 19 => 0.000001, 20 => 0.000001, 21 => 0.000001,
      22 => 0.000001, 23 => 0.000001, 24 => 0.000001, 25 => 0.000001,
      26 => 0.000001, 27 => 0.000001, 28 => 0.000001, 29 => 0.000001,
      30 => 0.000001, 31 => 0.000001, 32 => 0.171662, 33 => 0.000072,
      34 => 0.002442, 35 => 0.000179, 36 => 0.000561, 37 => 0.000160,
      38 => 0.000226, 39 => 0.002447, 40 => 0.002178, 41 => 0.002233,
      42 => 0.000628, 43 => 0.000215, 44 => 0.007384, 45 => 0.013734,
      46 => 0.015124, 47 => 0.001549, 48 => 0.005516, 49 => 0.004594,
      50 => 0.003322, 51 => 0.001847, 52 => 0.001348, 53 => 0.001663,
      54 => 0.001153, 55 => 0.001030, 56 => 0.001054, 57 => 0.001024,
      58 => 0.004354, 59 => 0.001214, 60 => 0.001225, 61 => 0.000227,
      62 => 0.001242, 63 => 0.001474, 64 => 0.000073, 65 => 0.003132,
      66 => 0.002163, 67 => 0.003906, 68 => 0.003151, 69 => 0.002673,
      70 => 0.001416, 71 => 0.001876, 72 => 0.002321, 73 => 0.003211,
      74 => 0.001726, 75 => 0.000687, 76 => 0.001884, 77 => 0.003529,
      78 => 0.002085, 79 => 0.001842, 80 => 0.002614, 81 => 0.000316,
      82 => 0.002519, 83 => 0.004003, 84 => 0.003322, 85 => 0.000814,
      86 => 0.000892, 87 => 0.002527, 88 => 0.000343, 89 => 0.000304,
      90 => 0.000076, 91 => 0.000086, 92 => 0.000016, 93 => 0.000088,
      94 => 0.000003, 95 => 0.001159, 96 => 0.000009, 97 => 0.051880,
      98 => 0.010195, 99 => 0.021129,
      100 => 0.025071, 101 => 0.085771, 102 => 0.013725, 103 => 0.015597,
      104 => 0.027444, 105 => 0.049019, 106 => 0.000867, 107 => 0.006753,
      108 => 0.031750, 109 => 0.016437, 110 => 0.049701, 111 => 0.057701,
      112 => 0.015482, 113 => 0.000747, 114 => 0.042586, 115 => 0.043686,
      116 => 0.063700, 117 => 0.020999, 118 => 0.008462, 119 => 0.013034,
      120 => 0.001950, 121 => 0.011330, 122 => 0.000596, 123 => 0.000026,
      124 => 0.000007, 125 => 0.000026, 126 => 0.000003, 127 => 0.000001,
      128 => 0.000001, 129 => 0.000001, 130 => 0.000001, 131 => 0.000001,
      132 => 0.000001, 133 => 0.000001, 134 => 0.000001, 135 => 0.000001,
      136 => 0.000001, 137 => 0.000001, 138 => 0.000001, 139 => 0.000001,
      140 => 0.000001, 141 => 0.000001, 142 => 0.000001, 143 => 0.000001,
      144 => 0.000001, 145 => 0.000001, 146 => 0.000001, 147 => 0.000001,
      148 => 0.000001, 149 => 0.006410, 150 => 0.000001, 151 => 0.000001,
      152 => 0.000001, 153 => 0.000001, 154 => 0.000001, 155 => 0.000001,
      156 => 0.000001, 157 => 0.000001, 158 => 0.000001, 159 => 0.000001,
      160 => 0.000001, 161 => 0.000001, 162 => 0.000001, 163 => 0.000001,
      164 => 0.000001, 165 => 0.000001, 166 => 0.000001, 167 => 0.000001,
      168 => 0.000001, 169 => 0.000001, 170 => 0.000001, 171 => 0.000001,
      172 => 0.000001, 173 => 0.000001, 174 => 0.000001, 175 => 0.000001,
      176 => 0.000001, 177 => 0.000001, 178 => 0.000001, 179 => 0.000001,
      180 => 0.000001, 181 => 0.000001, 182 => 0.000001, 183 => 0.000010,
      184 => 0.000001, 185 => 0.000001, 186 => 0.000001, 187 => 0.000001,
      188 => 0.000001, 189 => 0.000001, 190 => 0.000001, 191 => 0.000001,
      192 => 0.000001, 193 => 0.000001, 194 => 0.000001, 195 => 0.000001,
      196 => 0.000001, 197 => 0.000001, 198 => 0.000001, 199 => 0.000001,
      200 => 0.000001, 201 => 0.000001, 202 => 0.000001, 203 => 0.000001,
      204 => 0.000001, 205 => 0.000001, 206 => 0.000001, 207 => 0.000001,
      208 => 0.000001, 209 => 0.000001, 210 => 0.000001, 211 => 0.000001,
      212 => 0.000001, 213 => 0.000001, 214 => 0.000001, 215 => 0.000001,
      216 => 0.000001, 217 => 0.000001, 218 => 0.000001, 219 => 0.000001,
      220 => 0.000001, 221 => 0.000001, 222 => 0.000001, 223 => 0.000001,
      224 => 0.000001, 225 => 0.000001, 226 => 0.000001, 227 => 0.000001,
      228 => 0.000001, 229 => 0.000001, 230 => 0.000001, 231 => 0.000001,
      232 => 0.000001, 233 => 0.000001, 234 => 0.000001, 235 => 0.000001,
      236 => 0.000001, 237 => 0.000001, 238 => 0.000001, 239 => 0.000001,
      240 => 0.000001, 241 => 0.000001, 242 => 0.000001, 243 => 0.000001,
      244 => 0.000001, 245 => 0.000001, 246 => 0.000001, 247 => 0.000001,
      248 => 0.000001, 249 => 0.000001, 250 => 0.000001, 251 => 0.000001,
      252 => 0.000001, 253 => 0.000001, 254 => 0.000001, 255 => 0.000001
    }
  end

  # Default is essentially chi-square testing.
  def exp_error(text, exp = 2)
    exp_error = 0.0
    (0..255).each do |ascii|
      observed = (text.scan(ascii.chr.downcase).size.to_f / text.size)

      exp_error += ((observed - @lookup[ascii]).abs ** exp) / @lookup[ascii]
    end

    return exp_error
  end
end
